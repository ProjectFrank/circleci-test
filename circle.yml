test:
  override:
    - echo "no tests"; false
  post:
    - echo "post"
      
deployment:
  allthethings:
    branch: /.*/
    commands:
      - ::wait-for-deploy-lock
      - echo "deployment"

compile:
  override: 
    - echo stuff

teardown:
  pre:
    - echo "stuff"

notify:
  webhooks:
    - url: http://requestb.in/notvalid

checkout:
  post:
    - pwd

machine:
#   environment:
#     testvar: $HOME
#   node:
#     version: stable
  pre:
    - |
      curl -H "accept: application/json" https://circleci.com/api/v1/project/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/tree/$CIRCLE_BRANCH\?limit\=100\?circle-token\=$CIRCLE_TOKEN
  # Log all commits since last commit in last successful build
    - |
      cd $CIRCLE_PROJECT_REPONAME && git log `echo $(curl -H "accept: application/json" https://circleci.com/api/v1/project/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/tree/$CIRCLE_BRANCH\?limit\=100\?circle-token\=$CIRCLE_TOKEN | jq '[.[] | select(.status=="success" or .status=="fixed") | .all_commit_details[-1].commit][0]') | sed -e 's/^"//'  -e 's/"$//'`..HEAD | cat | tee changelog.txt

dependencies:
  override:
    - echo "nothing"