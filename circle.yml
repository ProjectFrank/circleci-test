
test:
  override:
    - echo "no tests"
  post:
    - echo "post"
      
deployment:
  allthethings:
    branch: /.*/
    commands:
      - ::wait-for-deploy-lock
      - echo "deployment"

compile:
  override: 
    - echo stuff

teardown:
  pre:
    - echo "stuff"

notify:
  webhooks:
    - url: http://requestb.in/notvalid

checkout:
  post:
    - pwd

machine:
  environment:
    DYLD_LIBRARY_PATH: /Applications/Xcode-7.2.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib:$(DYLD_LIBRARY_PATH)
    PATH: ~/bin:$PATH
  node:
    version: 4.2.6
  pre:
    - |
      curl -H "accept: application/json" https://circleci.com/api/v1/project/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/tree/$CIRCLE_BRANCH\?limit\=100\&circle-token\=$CIRCLE_TOKEN
  # Log all commits since last commit in last successful build
    - |
      cd $CIRCLE_PROJECT_REPONAME && git log `echo $(curl -H "accept: application/json" https://circleci.com/api/v1/project/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/tree/$CIRCLE_BRANCH\?limit\=100\?circle-token\=$CIRCLE_TOKEN | jq '[.[] | select(.status=="success" or .status=="fixed") | .all_commit_details[-1].commit][0]') | sed -e 's/^"//'  -e 's/"$//'`..HEAD | cat | tee changelog.txt
    - |
      if [ [ $CIRCLE_BRANCH == 'master' ] && [ `git name-rev --name-only HEAD` != 'master' ] ];
      then git branch -d `git name-rev --name-only HEAD`;
      fi
  post:
    - npm -v
dependencies:
  pre:
  - git rev-parse --git-dir
  - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || (git fetch --unshallow --tags; echo \"ran git fetch\")"
  override:
    - echo "nothing"
    - sudo apt-get update; sudo apt-get install heroku-toolbelt
    - heroku update